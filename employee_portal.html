<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Holland Homes — Employee Portal</title>

<!-- Papa Parse for CSV loading -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --brand:#184A30;
    --brand-soft:#e4f3eb;
    --ink:#111827;
    --muted:#6b7280;
    --bg:#f3f4f6;
    --card:#ffffff;
    --line:#e5e7eb;
    --danger:#b91c1c;
  }
  *{ box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, sans-serif; }
  body{
    margin:0;
    background:radial-gradient(circle at top,#eef2ff,#f3f4f6,#e4f3eb);
    color:var(--ink);
  }
  header{
    background:var(--brand);
    color:#fff;
  }
  .bar{
    max-width:1100px;
    margin:0 auto;
    padding:14px 16px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .brand{
    margin:0;
    font-size:18px;
    letter-spacing:.02em;
  }
  .tagline{
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:.18em;
    opacity:.85;
  }
  .wrap{
    max-width:1100px;
    margin:0 auto;
    padding:18px 14px 32px;
  }

  .layout{
    display:grid;
    grid-template-columns:minmax(0,1.3fr) minmax(0,1.1fr);
    gap:18px;
  }
  @media (max-width:900px){
    .layout{ grid-template-columns:1fr; }
  }

  .card{
    background:var(--card);
    border-radius:18px;
    border:1px solid var(--line);
    box-shadow:0 10px 30px rgba(15,23,42,0.07);
    padding:18px;
  }
  h2{
    margin:0 0 4px;
    font-size:18px;
  }
  .muted{ font-size:13px; color:var(--muted); }

  /* Login card */
  .field-group{
    margin-top:12px;
    display:flex;
    flex-direction:column;
    gap:4px;
    font-size:13px;
  }
  label{
    font-weight:600;
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:.14em;
    color:var(--muted);
  }
  input[type="text"],
  input[type="password"]{
    border-radius:999px;
    border:1px solid var(--line);
    padding:8px 12px;
    font-size:14px;
    outline:none;
    background:#f9fafb;
  }
  input:focus{
    border-color:var(--brand);
    box-shadow:0 0 0 1px rgba(24,74,48,0.12);
    background:#fff;
  }
  .hint{ font-size:11px; color:var(--muted); margin-top:2px; }

  .btn{
    border-radius:999px;
    border:1px solid var(--brand);
    background:var(--brand);
    color:#fff;
    padding:8px 16px;
    font-size:14px;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:6px;
    margin-top:14px;
  }
  .btn.secondary{
    background:#fff;
    color:var(--brand);
  }
  .btn[disabled]{
    opacity:.6;
    cursor:not-allowed;
  }

  .error{
    margin-top:10px;
    font-size:13px;
    color:var(--danger);
  }
  .pill-ethos{
    display:inline-flex;
    align-items:center;
    gap:4px;
    padding:4px 10px;
    border-radius:999px;
    background:var(--brand-soft);
    color:var(--brand);
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:.15em;
    margin-top:10px;
  }

  /* Suggestions list for name search */
  .suggestions{
    margin-top:4px;
    border-radius:12px;
    border:1px solid var(--line);
    background:#fff;
    max-height:150px;
    overflow:auto;
    box-shadow:0 8px 20px rgba(15,23,42,0.15);
  }
  .suggestion{
    padding:6px 10px;
    font-size:13px;
    cursor:pointer;
  }
  .suggestion:hover{
    background:#f3f4f6;
  }

  /* Employee dashboard */
  .emp-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:12px;
  }
  .emp-name{
    font-size:20px;
    font-weight:700;
  }
  .emp-meta{
    font-size:13px;
    color:var(--muted);
  }
  .badge{
    display:inline-flex;
    padding:3px 9px;
    border-radius:999px;
    background:#e5e7eb;
    font-size:11px;
    margin-right:4px;
  }
  .chunks{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:12px;
  }
  @media (max-width:700px){
    .chunks{ grid-template-columns:1fr; }
  }
  .chunk{
    border-radius:14px;
    border:1px solid var(--line);
    background:#f9fafb;
    padding:12px;
    font-size:13px;
  }
  .chunk h3{
    margin:0 0 6px;
    font-size:14px;
  }
  .kv{
    display:flex;
    justify-content:space-between;
    margin-bottom:4px;
  }
  .kv span:last-child{
    font-weight:600;
  }

  .links-list{
    list-style:none;
    padding-left:0;
    margin:4px 0 0;
    font-size:13px;
  }
  .links-list li{
    margin:2px 0;
  }
  .links-list a{
    color:#1d4ed8;
    text-decoration:none;
  }
  .links-list a:hover{
    text-decoration:underline;
  }

  .small-note{
    margin-top:10px;
    font-size:11px;
    color:var(--muted);
  }
</style>
</head>
<body>
<header>
  <div class="bar">
    <div>
      <h1 class="brand">Holland Homes — Employee Portal</h1>
      <div class="tagline">Purpose &gt; People &gt; Process &gt; Product</div>
    </div>
    <div style="font-size:12px; text-align:right;">
      <div>Internal prototype · CSV-driven</div>
      <div style="opacity:.8;">Best for non-sensitive data on public hosting.</div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="layout">
    <!-- LOGIN PANEL -->
    <section class="card" id="loginCard">
      <h2>Log in to your snapshot</h2>
      <p class="muted">
        Start typing your name, pick it from the list, and enter your PIN.
        This matches your row in the employee reference sheet.
      </p>

      <div class="field-group">
        <label for="nameInput">Your name</label>
        <input id="nameInput" type="text" autocomplete="off"
               placeholder="Begin typing your name…" />
        <div id="nameHint" class="hint">Employee names are loaded from <code>employee_reference.csv</code>.</div>
        <div id="suggestions" class="suggestions" style="display:none;"></div>
      </div>

      <div class="field-group">
        <label for="pinInput">PIN</label>
        <input id="pinInput" type="password" inputmode="numeric" maxlength="10"
               placeholder="4–6 digit PIN" />
        <div class="hint">
          For security, use a random PIN field in the CSV, not the last four of SSN if
          this is public-facing.
        </div>
      </div>

      <button id="loginBtn" class="btn" disabled>
        <span>Log in</span>
      </button>

      <div id="loginError" class="error" style="display:none;"></div>

      <div class="pill-ethos">
        <span>People · Clarity · Self-service</span>
      </div>

      <p class="small-note">
        Admins can inspect the full CSV directly or extend this page later with a
        dedicated admin view. This screen is focused on an individual’s snapshot.
      </p>
    </section>

    <!-- DASHBOARD PANEL -->
    <section class="card" id="dashCard" style="display:none;">
      <div class="emp-header">
        <div>
          <div class="emp-name" id="empName"></div>
          <div class="emp-meta" id="empMeta"></div>
        </div>
        <div>
          <div id="empBadges"></div>
          <button class="btn secondary" id="logoutBtn" style="margin-top:8px;">Log out</button>
        </div>
      </div>

      <div class="chunks">
        <div class="chunk">
          <h3>PTO Snapshot</h3>
          <div class="kv">
            <span>Total PTO</span><span id="ptoTotal">–</span>
          </div>
          <div class="kv">
            <span>PTO Used</span><span id="ptoUsed">–</span>
          </div>
          <div class="kv">
            <span>PTO Remaining</span><span id="ptoRemaining">–</span>
          </div>
          <p class="small-note">
            Detailed PTO calendar still lives in the main PTO dashboard.
          </p>
        </div>

        <div class="chunk">
          <h3>Role &amp; Comp (summary)</h3>
          <div class="kv">
            <span>Role</span><span id="empRole">–</span>
          </div>
          <div class="kv">
            <span>Department</span><span id="empDept">–</span>
          </div>
          <div class="kv">
            <span>Manager</span><span id="empManager">–</span>
          </div>
          <div class="kv">
            <span>Salary / Band</span><span id="empSalary">–</span>
          </div>
          <p class="small-note">
            Any sensitive salary info should only be exposed if this page is hosted behind secure authentication.
          </p>
        </div>

        <div class="chunk">
          <h3>Contact &amp; Status</h3>
          <div class="kv">
            <span>Email</span><span id="empEmail">–</span>
          </div>
          <div class="kv">
            <span>Location</span><span id="empLocation">–</span>
          </div>
          <div class="kv">
            <span>Status</span><span id="empStatus">–</span>
          </div>
          <p class="small-note">
            Need to update something? Reach out to People / HR so the employee reference
            file stays the single source of truth.
          </p>
        </div>

        <div class="chunk">
          <h3>Quick Links</h3>
          <ul class="links-list">
            <li><a href="./index_pto.html" target="_blank">Open full PTO dashboard</a></li>
            <li><a href="./ppp.html" target="_blank">Open PPP / People Profit Performance</a></li>
            <li><a href="./index_contacts.html" target="_blank">Open Contacts &amp; Org View</a></li>
            <li><a href="#" target="_blank">Policies &amp; Procedures (SharePoint)</a></li>
            <li><a href="#" target="_blank">My documents folder (SharePoint)</a></li>
          </ul>
          <p class="small-note">
            Swap the <code>#</code> links above with your actual SharePoint URLs for policies
            and personal document folders.
          </p>
        </div>
      </div>
    </section>
  </div>
</main>

<script>
  const CSV_URL = "./employee_reference.csv";

  let employees = [];
  let selectedEmployee = null;

  const nameInput = document.getElementById("nameInput");
  const pinInput = document.getElementById("pinInput");
  const suggestionsEl = document.getElementById("suggestions");
  const loginBtn = document.getElementById("loginBtn");
  const loginError = document.getElementById("loginError");
  const loginCard = document.getElementById("loginCard");
  const dashCard = document.getElementById("dashCard");
  const logoutBtn = document.getElementById("logoutBtn");

  // Dashboard fields
  const empNameEl = document.getElementById("empName");
  const empMetaEl = document.getElementById("empMeta");
  const empBadgesEl = document.getElementById("empBadges");
  const ptoTotalEl = document.getElementById("ptoTotal");
  const ptoUsedEl = document.getElementById("ptoUsed");
  const ptoRemainingEl = document.getElementById("ptoRemaining");
  const empRoleEl = document.getElementById("empRole");
  const empDeptEl = document.getElementById("empDept");
  const empManagerEl = document.getElementById("empManager");
  const empSalaryEl = document.getElementById("empSalary");
  const empEmailEl = document.getElementById("empEmail");
  const empLocationEl = document.getElementById("empLocation");
  const empStatusEl = document.getElementById("empStatus");

  // Load CSV once
  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    dynamicTyping: false,
    complete: function(results){
      employees = results.data.filter(r => r && r.EmployeeName);
      console.log("Loaded employees:", employees.length);
    },
    error: function(err){
      console.error("Error loading employee_reference.csv", err);
      document.getElementById("nameHint").textContent =
        "Error loading employee_reference.csv – check the file path and CORS.";
    }
  });

  // Name search / suggestions
  nameInput.addEventListener("input", function(){
    const q = nameInput.value.trim().toLowerCase();
    selectedEmployee = null;
    loginBtn.disabled = true;
    hideError();
    if (!q){
      suggestionsEl.style.display = "none";
      suggestionsEl.innerHTML = "";
      return;
    }
    const matches = employees.filter(e =>
      String(e.EmployeeName).toLowerCase().includes(q) ||
      String(e.PreferredName || "").toLowerCase().includes(q)
    ).slice(0, 12);

    if (!matches.length){
      suggestionsEl.style.display = "none";
      suggestionsEl.innerHTML = "";
      return;
    }
    suggestionsEl.innerHTML = "";
    matches.forEach(emp => {
      const row = document.createElement("div");
      row.className = "suggestion";
      const label = emp.PreferredName && emp.PreferredName.trim()
        ? `${emp.PreferredName} (${emp.EmployeeName})`
        : emp.EmployeeName;
      row.textContent = label;
      row.addEventListener("click", () => {
        nameInput.value = emp.EmployeeName;
        selectedEmployee = emp;
        suggestionsEl.style.display = "none";
        suggestionsEl.innerHTML = "";
        updateLoginButtonState();
        pinInput.focus();
      });
      suggestionsEl.appendChild(row);
    });
    suggestionsEl.style.display = "block";
  });

  nameInput.addEventListener("blur", function(){
    setTimeout(() => { suggestionsEl.style.display = "none"; }, 180);
  });

  pinInput.addEventListener("input", function(){
    hideError();
    updateLoginButtonState();
  });

  function updateLoginButtonState(){
    loginBtn.disabled = !(selectedEmployee && pinInput.value.trim());
  }

  loginBtn.addEventListener("click", handleLogin);

  function handleLogin(){
    hideError();
    if (!selectedEmployee){
      showError("Please select your name from the list.");
      return;
    }
    const pin = String(pinInput.value || "").trim();
    const rowPin = String(selectedEmployee.Pin || "").trim();

    if (!rowPin){
      showError("No PIN is configured for this employee in the reference file.");
      return;
    }
    if (pin !== rowPin){
      showError("PIN does not match our records. Double-check and try again.");
      return;
    }

    showDashboard(selectedEmployee);
  }

  function showError(msg){
    loginError.textContent = msg;
    loginError.style.display = "block";
  }
  function hideError(){
    loginError.style.display = "none";
    loginError.textContent = "";
  }

  function showDashboard(emp){
    // Populate dashboard fields
    const displayName = emp.PreferredName && emp.PreferredName.trim()
      ? emp.PreferredName
      : emp.EmployeeName;

    empNameEl.textContent = displayName;
    empMetaEl.textContent = `${emp.Role || "Role N/A"} · ${emp.Department || "Dept N/A"}`;

    empBadgesEl.innerHTML = "";
    if (emp.Location){
      const b = document.createElement("span");
      b.className = "badge";
      b.textContent = emp.Location;
      empBadgesEl.appendChild(b);
    }
    if (emp.Manager){
      const b = document.createElement("span");
      b.className = "badge";
      b.textContent = "Manager: " + emp.Manager;
      empBadgesEl.appendChild(b);
    }

    ptoTotalEl.textContent = emp.PTO_Total || "–";
    ptoUsedEl.textContent = emp.PTO_Used || "–";
    ptoRemainingEl.textContent = emp.PTO_Remaining || "–";

    empRoleEl.textContent = emp.Role || "–";
    empDeptEl.textContent = emp.Department || "–";
    empManagerEl.textContent = emp.Manager || "–";
    empSalaryEl.textContent = emp.Salary_Display || "–";

    empEmailEl.textContent = emp.Email || "–";
    empLocationEl.textContent = emp.Location || "–";
    empStatusEl.textContent = emp.Status || "–";

    loginCard.style.display = "none";
    dashCard.style.display = "block";
    window.scrollTo({top:0, behavior:"smooth"});
  }

  logoutBtn.addEventListener("click", function(){
    dashCard.style.display = "none";
    loginCard.style.display = "block";
    selectedEmployee = null;
    nameInput.value = "";
    pinInput.value = "";
    loginBtn.disabled = true;
    hideError();
  });
</script>
</body>
</html>
